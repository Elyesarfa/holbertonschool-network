#!/usr/bin/env bash
# This script modifies the /etc/hosts file to change the IP address resolution for localhost and facebook.com


# Backup the current /etc/hosts file
sudo cp /etc/hosts /etc/hosts.bak

# Display a message indicating that the script is about to make changes
echo "Modifying /etc/hosts to update IP resolutions."

# Create a temporary file for modified hosts content
temp_file=$(mktemp)

# Read the existing /etc/hosts file and make the necessary replacements
while IFS= read -r line; do
    if [[ $line =~ ^127\.0\.0\.1 ]]; then
        echo "127.0.0.2 localhost" >> "$temp_file"
    elif [[ $line =~ ^8\.8\.8\.8 ]]; then
        # Skip existing facebook.com entry to be updated later
        continue
    else
        echo "$line" >> "$temp_file"
    fi
done < /etc/hosts

# Append the new facebook.com entry if not already present
if ! grep -q "^8\.8\.8\.8 facebook.com" "$temp_file"; then
    echo "8.8.8.8 facebook.com" >> "$temp_file"
fi

# Replace the old /etc/hosts file with the updated one
sudo mv "$temp_file" /etc/hosts

# Inform the user that the script has completed its execution
echo "The /etc/hosts file has been updated:"
cat /etc/hosts

